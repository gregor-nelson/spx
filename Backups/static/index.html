<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPX Options Monitor</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Top Toolbar (TWS Style) -->
        <header class="toolbar">
            <div class="toolbar-brand">
                <i class="ph ph-chart-line-up"></i>
                <span class="brand-name">SPX</span>
                <span class="brand-sub">Options Monitor</span>
            </div>
            <div class="toolbar-divider"></div>
            <div class="toolbar-stats">
                <div class="toolbar-stat">
                    <i class="ph ph-trend-up"></i>
                    <span class="stat-label">SPX</span>
                    <span class="stat-value" id="toolbarSpx">-</span>
                </div>
                <div class="toolbar-stat">
                    <i class="ph ph-file-text"></i>
                    <span class="stat-label">Contracts</span>
                    <span class="stat-value" id="toolbarContracts">-</span>
                </div>
                <div class="toolbar-stat">
                    <i class="ph ph-flag-pennant"></i>
                    <span class="stat-label">Flagged</span>
                    <span class="stat-value" id="toolbarFlagged">-</span>
                </div>
                <div class="toolbar-stat">
                    <i class="ph ph-arrows-clockwise"></i>
                    <span class="stat-label">Polls</span>
                    <span class="stat-value" id="toolbarPolls">-</span>
                </div>
                <div class="toolbar-stat">
                    <i class="ph ph-bell-ringing"></i>
                    <span class="stat-label">Alerts</span>
                    <span class="stat-value" id="toolbarAlerts">-</span>
                </div>
            </div>
            <div class="toolbar-actions">
                <button class="toolbar-btn" onclick="loadAll()" title="Refresh Data">
                    <i class="ph ph-arrow-clockwise"></i>
                    <span>Refresh</span>
                </button>
            </div>
            <div class="toolbar-divider"></div>
            <div class="toolbar-time">
                <i class="ph ph-clock"></i>
                <span id="toolbarTime">--:--</span>
            </div>
        </header>

        <!-- 3-Column Layout -->
        <div class="terminal" id="terminal">
            <!-- Left Sidebar: Navigation -->
            <aside class="sidebar" id="sidebar">
                <button class="sidebar-toggle" onclick="toggleSidebar()" title="Toggle Sidebar (Ctrl+B)">
                    <i class="ph ph-caret-left" id="toggleIcon"></i>
                </button>

                <nav class="nav-tabs">
                    <button class="nav-tab active" onclick="showTab('charts')" title="Charts">
                        <i class="ph ph-chart-bar nav-icon"></i>
                        <span class="nav-text">Charts</span>
                    </button>
                    <button class="nav-tab" onclick="showTab('greeks')" title="Greeks">
                        <i class="ph ph-graph nav-icon"></i>
                        <span class="nav-text">Greeks</span>
                    </button>
                    <button class="nav-tab" onclick="showTab('latest')" title="Latest Snapshot">
                        <i class="ph ph-pulse nav-icon"></i>
                        <span class="nav-text">Latest</span>
                    </button>
                    <button class="nav-tab" onclick="showTab('intraday')" title="Intraday Data">
                        <i class="ph ph-clock-afternoon nav-icon"></i>
                        <span class="nav-text">Intraday</span>
                    </button>
                    <button class="nav-tab" onclick="showTab('daily')" title="Historical Data">
                        <i class="ph ph-calendar-blank nav-icon"></i>
                        <span class="nav-text">History</span>
                    </button>
                    <button class="nav-tab" onclick="showTab('alerts')" title="Alerts">
                        <i class="ph ph-warning nav-icon"></i>
                        <span class="nav-text">Alerts</span>
                    </button>
                </nav>

                <div class="sidebar-section">
                    <label class="section-label">
                        <i class="ph ph-calendar"></i>
                        Expiration
                    </label>
                    <select id="expirationFilter" onchange="onExpirationChange()">
                        <option value="">All</option>
                    </select>
                </div>

                <div class="sidebar-section stats-compact">
                    <label class="section-label">
                        <i class="ph ph-info"></i>
                        Session
                    </label>
                    <div class="stat-row">
                        <span class="stat-key"><i class="ph ph-arrows-clockwise"></i> Polls</span>
                        <span class="stat-val" id="statPolls">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-key"><i class="ph ph-file-text"></i> Contracts</span>
                        <span class="stat-val" id="statContracts">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-key"><i class="ph ph-calendar-dots"></i> Expirations</span>
                        <span class="stat-val" id="statExpirations">-</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-key"><i class="ph ph-database"></i> DB</span>
                        <span class="stat-val" id="statDbSize">-</span>
                    </div>
                </div>

                <div class="sidebar-footer">
                    <span class="last-updated" id="lastUpdated">-</span>
                    <button class="refresh-btn" onclick="loadAll()" title="Refresh">
                        <i class="ph ph-arrow-clockwise"></i>
                    </button>
                </div>
            </aside>

            <!-- Main Content Area -->
            <main class="main-content" id="content">
                <div class="loading">Loading...</div>
            </main>

            <!-- Right Panel: Detail/Movers -->
            <aside class="detail-panel" id="detailPanel">
                <button class="detail-toggle" onclick="toggleDetailPanel()" title="Toggle Movers Panel (Ctrl+])">
                    <i class="ph ph-caret-right" id="detailToggleIcon"></i>
                </button>
                <div class="panel-header">
                    <span class="panel-title">Movers</span>
                    <div class="comparison-toggle">
                        <button class="toggle-btn active" onclick="setComparisonMode('hour')" title="Compare to 1 hour ago">1H</button>
                        <button class="toggle-btn" onclick="setComparisonMode('eod')" title="Compare to end of day">EOD</button>
                    </div>
                </div>
                <div class="sort-controls">
                    <button class="sort-btn active" data-sort="volume" onclick="setSortBy('volume')" title="Sort by Volume">Vol</button>
                    <button class="sort-btn" data-sort="oi" onclick="setSortBy('oi')" title="Sort by Open Interest">OI</button>
                    <button class="sort-btn" data-sort="delta" onclick="setSortBy('delta')" title="Sort by Volume Delta">Î”</button>
                    <button class="sort-btn" data-sort="notional" onclick="setSortBy('notional')" title="Sort by Notional Value">$</button>
                </div>
                <div id="moversList" class="movers-list">
                    <div class="loading">-</div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Shared configuration and utilities (no dependencies) -->
    <script src="/js/config.js"></script>
    <script src="/js/utils.js"></script>

    <!-- Components (depend on config.js, utils.js) -->
    <script src="/js/components/tables.js"></script>
    <script src="/js/components/movers.js"></script>
    <script src="/js/components/charts.js"></script>
    <script src="/js/components/greeks.js"></script>

    <!-- Main app (depends on all above) -->
    <script src="/js/app.js"></script>
</body>
</html>
